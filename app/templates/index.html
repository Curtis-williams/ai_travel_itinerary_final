<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Travel Planner</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>
</head>
<body>
  <div class="container">
    <h1>AI Travel Itinerary Generator</h1>
    <form method="POST" action="/plan" class="card">
      <div class="grid">
        <label>Traveler Name
          <input type="text" name="name" placeholder="Your name" value="{{ (form_payload.name if form_payload else '') }}"/>
        </label>
        <label>Destination *
          <input type="text" required name="destination" placeholder="e.g., Tokyo" value="{{ (form_payload.destination if form_payload else '') }}"/>
        </label>
        <label>Dates
          <input type="text" name="dates" placeholder="e.g., 2025-12-10 to 2025-12-15" value="{{ (form_payload.dates if form_payload else '') }}"/>
        </label>
        <label>Days
          <input type="number" name="days" min="1" max="14" value="{{ (form_payload.days if form_payload else 3) }}"/>
        </label>
        <label>Party Size
          <input type="number" name="party_size" min="1" max="10" value="{{ (form_payload.party_size if form_payload else 1) }}"/>
        </label>
        <label>Budget Level
          <select name="budget">
            <option value="tight" {% if form_payload and form_payload.budget=='tight' %}selected{% endif %}>Tight</option>
            <option value="moderate" {% if not form_payload or form_payload.budget=='moderate' %}selected{% endif %}>Moderate</option>
            <option value="luxury" {% if form_payload and form_payload.budget=='luxury' %}selected{% endif %}>Luxury</option>
          </select>
        </label>
        <label>Interests
          <input type="text" name="interests" placeholder="coffee, museums, hiking" value="{{ (form_payload.interests if form_payload else '') }}"/>
        </label>
        <label>Dietary Needs
          <input type="text" name="diet" placeholder="vegetarian, halal, etc." value="{{ (form_payload.diet if form_payload else '') }}"/>
        </label>
        <label>Hotel Area
          <input type="text" name="hotel_area" placeholder="Shinjuku, Downtown, etc." value="{{ (form_payload.hotel_area if form_payload else '') }}"/>
        </label>
        <label>Model
          <input type="text" name="model_name" value="{{ (form_payload.model_name if form_payload else 'gpt-4o-mini') }}"/>
        </label>
        <label>Temperature
          <input type="number" step="0.1" min="0" max="2" name="temperature" value="{{ (form_payload.temperature if form_payload else 0.6) }}"/>
        </label>
      </div>
      <button type="submit" class="primary">Generate Plan</button>
    </form>

    {% if result %}
      <div class="results">
        <h2>Summary</h2>
        <p>{{ result.summary }}</p>
        <h2>Itinerary</h2>
        {% for day in result.days %}
          <div class="day-card">
            <h3>{{ day.date }}</h3>
            <div class="slots">
              <div class="slot">
                <h4>Morning</h4>
                <ul>
                {% for item in day.morning %}
                  <li><strong>{{ item.name }}</strong> — {{ item.why }} ({{ item.rough_cost }}) • <em>{{ item.area }}</em></li>
                {% endfor %}
                </ul>
              </div>
              <div class="slot">
                <h4>Afternoon</h4>
                <ul>
                {% for item in day.afternoon %}
                  <li><strong>{{ item.name }}</strong> — {{ item.why }} ({{ item.rough_cost }}) • <em>{{ item.area }}</em></li>
                {% endfor %}
                </ul>
              </div>
              <div class="slot">
                <h4>Evening</h4>
                <ul>
                {% for item in day.evening %}
                  <li><strong>{{ item.name }}</strong> — {{ item.why }} ({{ item.rough_cost }}) • <em>{{ item.area }}</em></li>
                {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endfor %}

        <h2>Tips</h2>
        <ul>
          {% for t in result.tips %}<li>{{ t }}</li>{% endfor %}
        </ul>

        {% if budget %}
          <h2>Budget Planner</h2>
          <div class="budget">
            <div class="row"><span>Lodging</span><span>${{ '{:,.2f}'.format(budget.breakdown.lodging) }}</span></div>
            <div class="row"><span>Food</span><span>${{ '{:,.2f}'.format(budget.breakdown.food) }}</span></div>
            <div class="row"><span>Activities</span><span>${{ '{:,.2f}'.format(budget.breakdown.activities) }}</span></div>
            <div class="row"><span>Transit</span><span>${{ '{:,.2f}'.format(budget.breakdown.transit) }}</span></div>
            <div class="row total"><span>Total</span><span>${{ '{:,.2f}'.format(budget.total) }}</span></div>
            <div class="row"><em>Per person per day:</em><span>${{ '{:,.2f}'.format(budget.per_person_per_day) }}</span></div>
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</body>
</html>
